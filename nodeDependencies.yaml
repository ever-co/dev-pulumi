---
  - name: Playbook for installing Docker and Java on the agent nodes
    hosts: instances
    remote_user: ubuntu
    tasks:
      - name: Install dependencies for Docker repository
        apt:
          name: [ 'apt-transport-https', 'ca-certificates', 'curl', 'gnupg-agent', 'software-properties-common', 'openjdk-8-jre-headless', 'aptitude', 'python-minimal' ]
          update_cache: yes
        become: true

      - name: Add apt key
        apt_key:
          url: https://download.docker.com/linux/ubuntu/gpg
          state: "present"
        become: true
      
      - name: Add Docker repository
        apt_repository:
          repo: "deb [arch=amd64] https://download.docker.com/linux/ubuntu bionic stable"
          state: "present"
        become: true
        
      - name: Install Docker
        apt:
          name: [ 'docker-ce', 'docker-ce-cli', 'containerd.io' ]
          state: "present"
          update_cache: yes
        become: true
      
      - name: Start Docker Engine
        systemd:
          name: docker
          state: "started"
          enabled: yes
        become: true

      - name: Create Jenkins directory
        file:
          path: "/home/ubuntu/jenkins"
          state: "directory"
      
      - name: Add user to docker group
        user:
          name: ubuntu
          append: yes
          groups: [ 'docker' ]
        become: true